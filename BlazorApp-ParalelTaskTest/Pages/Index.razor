@using Microsoft.AspNetCore.Components.Web
@using Microsoft.AspNetCore.Components.Forms
@using System.Threading;


@page "/"

<PageTitle>Index</PageTitle>

<h1>Hello, world!</h1>



<div>
    <p>
        Digits:<br />
        <InputText @bind-Value="Name" />
    </p>

</div>


<div>
    <p>Digits @test(Name)</p>
</div>



<div>
    <p>Factorial  @GetIdListFromString(test(Name))</p>
</div>





@code 
{

   

    string? Name;

    string test(string _input)
    {

        return _input;

    }

    static int factorial(int a)
    {
        if (a == 0 || a == 1) return 1;
        else return a * factorial(a - 1);
    }


    public static string GetIdListFromString(string idList)
    {
        
        
        
        
        string output = "";

        if (idList != null)
        {
            Thread currentThread = Thread.CurrentThread;
            Console.WriteLine($"Id thread основного потока start: {currentThread.ManagedThreadId}");

            string[] values = idList.Split(',');

            List<int> ids = new List<int>(values.Length);
            List<int> aa = new List<int>(values.Length){ 0,0,0,0};

            Task[] tasks = new Task[values.Length];


            foreach (string s in values)
            {

                int i;

                if (int.TryParse(s, out i))
                {
                    ids.Add(i);
                }


            }

            for (int j=0; j<values.Length; j++)
            {

                Console.WriteLine("agaga   " + j);
                int ff = j;
                tasks[j] = new Task(() => { 

                    Console.WriteLine("ogogo  ff = " + ff + "   j =   " + j);
                    Console.WriteLine(factorial(ids[ff]));
                     // aa.Add(factorial(ids[ff])); 
                    Thread currentThread = Thread.CurrentThread;
                    Console.WriteLine($"Id thread потока: {currentThread.ManagedThreadId}");
                    aa[ff] = factorial(ids[ff]);
                });
            }

 
            foreach (Task tt in tasks)
            {
                tt.Start();

            }



            Task.WaitAll(tasks);

            foreach (int ss in aa)
            {

                output = output + ss + "  |  ";

            }

            Console.WriteLine(output);
            Thread currentThread1 = Thread.CurrentThread;
            Console.WriteLine($"Id thread основного потока end: {currentThread1.ManagedThreadId}");
            return output;


        }

        else
        {
            
            return " ";
        }
    }



}